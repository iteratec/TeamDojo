<!-- 
SPDX-FileCopyrightText: the TeamDojo authors

SPDX-License-Identifier: Apache-2.0
-->
# ADR-0005: Move Teamscore calculation to the backend

<!--
  Use one of the ADR status parameter based on status
  Please add a cross-reference link to the new ADR on 'superseded' ADR.
  e.g.: [ADR superseded by](ADR-NNNN.md)
-->
| <!-- -->       | <!-- -->                                                                             |
|----------------|--------------------------------------------------------------------------------------|
| **Status**:    | PROPOSED |
| **Date**:      | 2022-10-25                                                                          |
| **Author(s)**: | Amar Bolkan <amar.bolkan@iteratec.com                         |



## Context

Teamdojo has a feature, which tracks a score for each team. Calculation of this score is currently done client side. 
Depending on the amount of skills and teams the scores can be incorrect. This happens due to pagination and the client not checking if all records were queried.



## Decision

### Solution 1: Moving the calculation into the backend

Move team score calculations to the backend and create an Api, which 
the client can query.

Proposed API:

`/api/team-score/:teamId` : Accepts GET requests and returns the current score for the queried team. 

Files to be added to the backend:
- `CustomTeamscoreResource`
- `CustomTeamScoreService`

Files to be changed in the frontend:
- `src/main/webapp/app/custom/overview/teams/overview-teams.component.ts`
- `src/main/webapp/app/custom/teams/teams-status/teams-status.component.ts`

Files to be deleted:
- `src/main/webapp/app/custom/helper/team-score-calculation.ts`

<!--
Relevant files for score calculation:
- CompletionCheck `src/main/webapp/app/custom/helper/completion-check.ts`
- RelevanceCheck `src/main/webapp/app/custom/helper/relevance-check.ts`
- TeamScoreCalculation `src/main/webapp/app/custom/helper/team-score-calculation.ts`
- SkillStatusUtils `src/main/webapp/app/custom/helper/skill-status.ts`

mirror these classes in the backend
Variable used in TeamScore calculation: team (containing all achieved skills), all available skills, and all available badges
-->

### Solution 2: Query all entities

The main problem causing the score calculations to be incorrect is the fact pagination is being used. This means only a fixed number of records are returned by each query.
Currently the client doesn't check if all records were returned by the initial query.

A solution would be to keep sending queries until all entities have been returned by the backend.

## Consequences

### Solution 1:
This change would shift the computational load onto the server and provide a clear and easy way for the client to
query scores for each individual team. In turn new classes are added to the backend and the client code also needs to be adapted to use this new Api.
It would also lead to code duplication as `RelevanceCheck` and `CompletionCheck` are also used in different parts of the frontend.


### Solution 2: 
This would simply be a small adaption in the client code. Where the single query is replaced 
by a loop that checks if all pages have been queried.
In case of large datasets this solution could lead to higher network traffic and be a strain on the 
clients resources. 


