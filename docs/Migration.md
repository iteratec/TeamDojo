# Migration from v1 to v2

This document stores some hints and notes about our migration path.

## JHipster Baseline

To see what we changed in the generated code in v1 we need a baseline: Generated JHipster (5.8.1) app with v1 JDL:

1. Install the old JHipster version for v1: `npm install -g generator-jhipster@5.8.1`.
2. Create a dir for the baseline.
3. Copy `.yo-rc.json` and `teamDojo_v1.jdl` into this directory.
4. Generate the app: `jhipster app`
5. Generate the JDL: `jhipster import-jdl teamDojo_v1.jdl`

## Some Conventions

- Own classes will go into a sub package/direcotry `custom` (e.g. `CustomFooService` goes into `com.iteratec.teamdojo.services.custom`).
- Class/interface name of extensions (in the sense of sub classing) of generated classes start with `Extended`, eg. `ExtendedFooRepository`.
- Class/interface names of other custom code starts with `Custom`, e.g. `CustomAuditReposiotry`.

### Modification of Generated Code

First and only rule for dealing with generated code:

> **You never ever change generated code!**

The patterns how to _modify_ the behaviour of generated code are:

- subclassing
- dependency injection

If we need to change generated code for good reasons then we encapsulate each modification in eye-catchers:

```text
log.debug("REST request to get Badges by criteria: {}", criteria);

// ### MODIFICATION-START ###
if (extension.shouldFindBadgesBySkills(criteria)) {
    return extension.findBadgesBySkills(criteria, pageable);
}
// ### MODIFICATION-END ###

Page<BadgeDTO> page = badgeQueryService.findByCriteria(criteria, pageable);
```

## Gradle Stuff

- To download JavaDoc and Sources run `gradle cleanIdea idea`. Module added as described at [Stack Overflow](https://stackoverflow.com/questions/28404149/how-to-download-javadocs-and-sources-for-jar-using-gradle-2-0/33653146#33653146).

## Refactorings from v1 to v2

We changed some things in the JDL:

- "Organization" -> "Organisation"
- removed Mattermost stuff
- in some entities the property `name` was changed to `title`

## Random Note Stash

### Files missing in the V1 base version generated by diff-filename.sh

- `src/main/webapp/app/entities/team-skill/team-skill-vote.component.html`
- `src/main/webapp/app/entities/team-skill/team-skill-vote.component.ts`
- `src/main/webapp/app/feedback/feedback.component.html`
- `src/main/webapp/app/feedback/feedback.component.ts`
- `src/main/webapp/app/feedback/feedback.module.ts`
- `src/main/webapp/app/feedback/feedback.route.ts`
- `src/main/webapp/app/feedback/feedback.service.ts`
- `src/main/webapp/app/feedback/index.ts`
- `src/main/webapp/app/layouts/footer/footer.scss`
- `src/main/webapp/app/layouts/navbar/breadcrumb.service.ts`
- `src/main/webapp/app/overview/achievements/index.ts`
- `src/main/webapp/app/overview/achievements/overview-achievements.component.html`
- `src/main/webapp/app/overview/achievements/overview-achievements.component.ts`
- `src/main/webapp/app/overview/achievements/overview-achievements.scss`
- `src/main/webapp/app/overview/index.ts`
- `src/main/webapp/app/overview/overview.component.html`
- `src/main/webapp/app/overview/overview.component.ts`
- `src/main/webapp/app/overview/overview.module.ts`
- `src/main/webapp/app/overview/overview.route.ts`
- `src/main/webapp/app/overview/overview.scss`
- `src/main/webapp/app/overview/skills/overview-skills.component.html`
- `src/main/webapp/app/overview/skills/overview-skills.component.ts`
- `src/main/webapp/app/overview/skills/overview-skills.scss`
- `src/main/webapp/app/overview/skills/skill-details/overview-skill-details.component.html`
- `src/main/webapp/app/overview/skills/skill-details/overview-skill-details.component.ts`
- `src/main/webapp/app/overview/skills/skill-details/overview-skill-details.scss`
- `src/main/webapp/app/overview/teams/overview-teams.component.html`
- `src/main/webapp/app/overview/teams/overview-teams.component.ts`
- `src/main/webapp/app/overview/teams/overview-teams.scss`
- `src/main/webapp/app/server-info/index.ts`
- `src/main/webapp/app/server-info/server-info.module.ts`
- `src/main/webapp/app/server-info/server-info.service.ts`
- `src/main/webapp/app/shared/achievement/index.ts`
- `src/main/webapp/app/shared/achievement/item/achievement-item.component.html`
- `src/main/webapp/app/shared/achievement/item/achievement-item.component.ts`
- `src/main/webapp/app/shared/achievement/item/achievement-item.scss`
- `src/main/webapp/app/shared/achievement/model/achievement-progress.model.ts`
- `src/main/webapp/app/shared/achievement/model/highest-level.model.ts`
- `src/main/webapp/app/shared/achievement/model/progress.model.ts`
- `src/main/webapp/app/shared/background/background.component.html`
- `src/main/webapp/app/shared/background/background.component.ts`
- `src/main/webapp/app/shared/background/background.scss`
- `src/main/webapp/app/shared/common.resolver.ts`
- `src/main/webapp/app/shared/language/dojoTranslate.directive.ts`
- `src/main/webapp/app/shared/model/achievable-skill.model.ts`
- `src/main/webapp/app/shared/model/breadcrumb.model.ts`
- `src/main/webapp/app/shared/model/server-info.model.ts`
- `src/main/webapp/app/shared/model/skill-rate.model.ts`
- `src/main/webapp/app/shared/model/skill-status.ts`
- `src/main/webapp/app/shared/model/team-score.model.ts`
- `src/main/webapp/app/shared/notification/index.ts`
- `src/main/webapp/app/shared/notification/item/notification-item.component.html`
- `src/main/webapp/app/shared/notification/item/notification-item.component.ts`
- `src/main/webapp/app/shared/notification/item/notification-item.scss`
- `src/main/webapp/app/shared/notification/menu/notification-menu.component.html`
- `src/main/webapp/app/shared/notification/menu/notification-menu.component.ts`
- `src/main/webapp/app/shared/notification/menu/notification-menu.scss`
- `src/main/webapp/app/shared/notification/model/notification.model.ts`
- `src/main/webapp/app/shared/number-input/number-input.component.html`
- `src/main/webapp/app/shared/number-input/number-input.component.ts`
- `src/main/webapp/app/shared/number-input/number-input.scss`
- `src/main/webapp/app/shared/pipe/image-url.pipe.ts`
- `src/main/webapp/app/shared/pipe/skill-filter.pipe.ts`
- `src/main/webapp/app/shared/pipe/skill-sort.pipe.ts`
- `src/main/webapp/app/shared/pipe/truncate-string.pipe.ts`
- `src/main/webapp/app/shared/skill-details/skill-details-comments.component.html`
- `src/main/webapp/app/shared/skill-details/skill-details-comments.component.ts`
- `src/main/webapp/app/shared/skill-details/skill-details-comments.scss`
- `src/main/webapp/app/shared/skill-details/skill-details-info.component.html`
- `src/main/webapp/app/shared/skill-details/skill-details-info.component.ts`
- `src/main/webapp/app/shared/skill-details/skill-details-info.scss`
- `src/main/webapp/app/shared/skill-details/skill-details.component.ts`
- `src/main/webapp/app/shared/skill-score/skill-score.component.html`
- `src/main/webapp/app/shared/skill-score/skill-score.component.ts`
- `src/main/webapp/app/shared/skill-score/skill-score.scss`
- `src/main/webapp/app/shared/star-rating/star-rating.module.html`
- `src/main/webapp/app/shared/table-filter/table-filter.component.html`
- `src/main/webapp/app/shared/table-filter/table-filter.component.ts`
- `src/main/webapp/app/shared/table-filter/table-filter.scss`
- `src/main/webapp/app/shared/team-image/team-image.component.html`
- `src/main/webapp/app/shared/team-image/team-image.component.ts`
- `src/main/webapp/app/shared/team-image/team-image.scss`
- `src/main/webapp/app/shared/teams-selection/teams-selection.component.html`
- `src/main/webapp/app/shared/teams-selection/teams-selection.component.ts`
- `src/main/webapp/app/shared/teams-selection/teams-selection.resolve.ts`
- `src/main/webapp/app/shared/teams-selection/teams-selection.scss`
- `src/main/webapp/app/shared/teams-selection/teams-selection.service.ts`
- `src/main/webapp/app/shared/teams/teams-edit.component.html`
- `src/main/webapp/app/shared/teams/teams-edit.component.ts`
- `src/main/webapp/app/shared/teams/teams-edit.scss`
- `src/main/webapp/app/shared/trainings/trainings-add.component.html`
- `src/main/webapp/app/shared/trainings/trainings-add.component.ts`
- `src/main/webapp/app/shared/util/completion-check.ts`
- `src/main/webapp/app/shared/util/level-util.ts`
- `src/main/webapp/app/shared/util/relevance-check.ts`
- `src/main/webapp/app/shared/util/team-score-calculation.ts`
- `src/main/webapp/app/teams/index.ts`
- `src/main/webapp/app/teams/skill-details/skill-details-info/skill-details-info.component.ts`
- `src/main/webapp/app/teams/skill-details/skill-details-rating/skill-details-rating.component.html`
- `src/main/webapp/app/teams/skill-details/skill-details-rating/skill-details-rating.component.ts`
- `src/main/webapp/app/teams/skill-details/skill-details-rating/skill-details-rating.scss`
- `src/main/webapp/app/teams/skill-details/skill-details.component.html`
- `src/main/webapp/app/teams/skill-details/skill-details.component.ts`
- `src/main/webapp/app/teams/skill-details/skill-details.scss`
- `src/main/webapp/app/teams/teams-achievements.component.html`
- `src/main/webapp/app/teams/teams-achievements.component.ts`
- `src/main/webapp/app/teams/teams-achievements.scss`
- `src/main/webapp/app/teams/teams-achievements.service.ts`
- `src/main/webapp/app/teams/teams-skills.component.html`
- `src/main/webapp/app/teams/teams-skills.component.ts`
- `src/main/webapp/app/teams/teams-skills.scss`
- `src/main/webapp/app/teams/teams-skills.service.ts`
- `src/main/webapp/app/teams/teams-status.component.html`
- `src/main/webapp/app/teams/teams-status.component.ts`
- `src/main/webapp/app/teams/teams-status.scss`
- `src/main/webapp/app/teams/teams.component.html`
- `src/main/webapp/app/teams/teams.component.ts`
- `src/main/webapp/app/teams/teams.module.ts`
- `src/main/webapp/app/teams/teams.route.ts`
- `src/main/webapp/app/teams/teams.scss`
- `src/main/webapp/app/teams/teams.service.ts`
- `src/main/webapp/content/scss/\_colors.scss`
- `src/main/webapp/content/scss/mixins.scss`
- `src/main/webapp/i18n/de/feedback.json`
- `src/main/webapp/i18n/de/notification.json`
- `src/main/webapp/i18n/de/overview.json`
- `src/main/webapp/i18n/de/teams.json`
- `src/main/webapp/i18n/en/feedback.json`
- `src/main/webapp/i18n/en/notification.json`
- `src/main/webapp/i18n/en/overview.json`
- `src/main/webapp/i18n/en/teams.json`
- `src/test/java/BASEPACKAGE/repository/SkillRepositoryIntTest.java`
- `src/test/java/BASEPACKAGE/test/util/BadgeTestDataProvider.java`
- `src/test/java/BASEPACKAGE/test/util/DimensionTestDataProvider.java`
- `src/test/java/BASEPACKAGE/test/util/LevelTestDataProvider.java`
- `src/test/java/BASEPACKAGE/test/util/SkillTestDataProvider.java`
- `src/test/java/BASEPACKAGE/test/util/TeamTestDataProvider.java`
- `src/test/java/BASEPACKAGE/web/rest/TeamAchievableSkillResourceIntTest.java`
- `src/test/javascript/spec/app/shared/util/level-util.spec.ts`
- `src/test/javascript/spec/app/teams/teams-achievements.component.spec.ts`
- `src/test/javascript/spec/app/teams/teams-skills.component.spec.ts`
- `src/test/javascript/spec/helpers/Util.service.ts`

### @Transaction Tag in ExtendedServiceImpl Classes

- check if it is necessary to add the @Transaction Annotation to each ExtendedServiceImpl class
  - If I understand [this SO answer](https://stackoverflow.com/questions/9918594/spring-transactional-inheritance-rules) right it is sufficient to annotate the super class.

### Notes regarding migrated controller classes

- ignored CommentResource, DimensionResource, LevelSkillResource because the only difference consists of the following: `return ResponseEntity.ok().headers(headers).body(page.getContent());` -> `return new ResponseEntity<>(page.getContent(), headers, HttpStatus.OK);`.
  - ignored because it is the same (fluent API vs constructor).

### Test Code

- in v1 the generated Integration tests have the class name suffix `IntTes`, in v2 they have the suffix `IT`

### Frontend migration

- discuss whether @Input variables should be `!` or `| undefined` https://stackoverflow.com/questions/64874221/property-has-no-initializer-and-is-not-definitely-assigned-in-the-constructor
- sortLevels function used in teams.module was moved from the shared folder to a helper directory to not change the generated code, however if this function is used more often it would probably make sense to put it into the shared module to reduce imports
- Migrate `sortLevels` in level-utils

#### Teams-Achievement

- couldn't migrate getAchievementProgress, getHighestAchievedLevel, getLevelOrBadgeProgress methods due to missing IProgress model
- migrate v1 tests

#### Teams

- migrate v1 tests

#### custom-shared.module.ts
This module should contain all the custom components used across the application, which aren't part of any module in V1 

#### teams.route.ts
Weird return type of resolve function

#### dojoTranslate.directive.ts 
- content of getTranslation commented out: Find the correct way to retrieve current application mode

#### teams-edit.component.html
- lines depending on dojoTranslate.directive.ts are commented out

#### shared-common.module.ts
- AlertErrorComponent and AlertComponent already defined in another module, can probably removed later on
